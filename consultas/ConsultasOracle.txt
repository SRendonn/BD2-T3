CREATE TYPE dep_tipo AS OBJECT(
cod NUMBER(20), 
nom VARCHAR2(25)
);
/
CREATE TABLE departamento OF dep_tipo (
PRIMARY KEY(cod), UNIQUE(nom), nom NOT NULL);
/
CREATE TYPE ciu_tipo AS OBJECT(
cod NUMBER(20),
nom VARCHAR2(25),
midep REF dep_tipo);
/
CREATE TABLE ciudad OF ciu_tipo(
PRIMARY KEY(cod), UNIQUE(nom), nom NOT NULL,
SCOPE FOR (midep) IS departamento, midep NOT NULL);
/
CREATE TYPE prod_tipo AS OBJECT(
cod NUMBER(20),
nom VARCHAR2(25),
precio_unitario NUMBER(10)
);
/
CREATE TABLE producto OF prod_tipo (PRIMARY KEY(cod));
/
CREATE TYPE venta_tipo AS OBJECT(
miprod REF prod_tipo,
nro_unidades number(12)
);
/
CREATE OR REPLACE TYPE vent_varray AS 
VARRAY(200) OF venta_tipo;
/
CREATE TYPE emp_tipo AS OBJECT(
cc NUMBER(15),
nom VARCHAR2(20),
miciu REF ciu_tipo,
ventas vent_varray);
/
CREATE TABLE empleado OF emp_tipo (
PRIMARY KEY(cc), SCOPE FOR (miciu) IS ciudad, miciu NOT NULL);
/
CREATE TABLE historicoventas(
cc NUMBER(15) PRIMARY KEY,
totalacumuladoventas NUMBER(30) NOT NULL
);

SELECT e.miciu.nom AS ciudad, SUM(v.nro_unidades*v.miprod.precio_unitario) AS total
FROM empleado e, TABLE(e.ventas) v
WHERE e.miciu.nom = 'Medellín'
GROUP BY e.miciu.nom;

SELECT cedula, total FROM(SELECT e.cc as cedula, SUM(v.nro_unidades*v.miprod.precio_unitario) AS total FROM empleado e, TABLE(e.ventas) v WHERE e.miciu.nom = 'Chía' GROUP BY e.cc ORDER BY total DESC) WHERE rownum=1;

UPDATE empleado SET ventas=NULL;
UPDATE empleado SET ventas=vent_varray(venta_tipo((SELECT REF(pro) FROM producto pro WHERE pro.cod =8),2), venta_tipo((SELECT REF(pro) FROM producto pro WHERE pro.cod =10),2)) WHERE cc=1;
UPDATE historicoventas SET totalacumuladoventas = (SELECT total FROM(SELECT SUM(v.nro_unidades*v.miprod.precio_unitario) AS total FROM empleado e, TABLE(e.ventas) v GROUP BY cc ORDER BY total DESC)) WHERE cc=1;
